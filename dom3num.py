#!/usr/bin/env python3
# 06/02/2023
# Author: Clarence Subia

import argparse
import dns.resolver
import dns.reversename


G = "\033[92m"  # green
Y = "\033[93m"  # yellow
B = "\033[94m"  # blue
R = "\033[91m"  # red
W = "\033[0m"   # white


def parse_args():
    # Arguments
    parser = argparse.ArgumentParser(description="Python DNS Enumeration tool.")
    parser.add_argument("-t", "--target",  metavar="", help="Target domain or IP to be queried.")
    parser.add_argument("-q", "--query",  metavar="", type=str, nargs="*", help="Type of records: A, AAAA, NS, CNAME, MX, PTR, SOA, TXT")
    parser.add_argument("-f", "--file",  metavar="", help="Target file for multiple targets.")
    return parser.parse_args()


def query_record(host, record):
    try:
        if "ptr" in record:
            qname = dns.reversename.from_address(host)
            n = dns.resolver.resolve(qname, "PTR")
            for server in n:
                print(server)
        else:
            answer = dns.resolver.resolve(host, record.upper())
            print(f"\n{G}{record.upper()} Records:{W}")
            print("-" * 30)
            for server in answer:
                print(server.to_text())
    except dns.resolver.NoAnswer:
        pass
    except dns.resolver.NXDOMAIN:
        print(f"{R}[!] The DNS query for {record} does not exist! {W}")
        return
    except KeyboardInterrupt:
        quit()


def query(target, records):
    print(f"{G}[*] Starting DNS query for {str(target)}{W}")
    for record in records:
        query_record(target, record)


def main():
    args = parse_args()
    target = args.target
    record_type = args.query
    target_file = args.file

    if not target and not record_type and not target_file:
        print(f"{R}[!] Please provide arguements.{W}")
        print("Example: python3 dom3num.py --target google.com --query A")
        return

    if not record_type:
        record_type = ["A", "AAAA", "NS", "CNAME", "MX", "SOA", "TXT"]

    if target_file:
        file = open(target_file, "r")
        for host in file:
            query(host.strip("\n"), record_type)
    else:
        query(target, record_type)



if __name__ == "__main__": 
    main()
